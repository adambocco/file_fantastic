# File Fantastic

File Fantastic is a simple client-side file management library for the web. 

The core of this library is written in vanilla JS and has no dependencies. However, the cropper plugin uses Cropper.js. 

This library can provide a lightweight file management framework for some of the following use cases:
- Uploading files with the ability to modify, copy, replace, and remove them.
- Multiple file uploader instances that can be granularly configured for usage in complex forms such as in a CMS.
- Manage subset of a file system and view many files using `Paging` and `Directories` plugin.
- File syncing between when handling multiple files being modified.

# Features

- File management:
  - Upload, copy, remove, rename, and modify multiple files.
- JSON (Base 64 data URL) or Form Data request types
- Media previewability (images, audio, video)
- Icon types:
  - Font Awesome Icons, Material Icons, or Text Icons
- Plugins:
  - Paging
  - Directories
  - Cropper

## Table of Contents

- [Installation](#installation)
- [Setup](#setup)
- [Options](#options)
- [Callbacks](#callbacks)
- [Events](#events)
- [Methods](#methods)
- [Plugins](#plugins)
- [Examples](#examples)

# Installation


# Options

## **id**  
**Type:** `String`  
**Default:** `Unique ID generated by `this.generateUID()`  
**Usage:** Optionally suppress console errors and warnings. Helpful for identifying multiple instances.  
  
## **payloadType**  
**Type:** `String('formData' | 'json')`  
**Default:** `'formData'`  
**Usage:** Which type of payload will be used for all requests. If `json`, files will be sent encoded as base-64 data URL.  

## **multiple**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Allow uploading multiple files.  
  
## **existingUrls**  
**Type:** `Array | Object | String`  
**Default:** `[]`  
**Usage:** Add existing files when initializing. Existing URL must be string of file URL or object containing key,   **url**. Can be single or array of existing URLs.
  
## **uploadIndividually**  
**Type:** `Boolean`  
**Default:** `false`  
**Usage:** If true, only one file will be uploaded at once. Otherwise, they will be grouped into an array.  
  
## **uploadOnInput**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Make upload request automatically when file input change event triggered.  
  
## **previewable**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Allow previews of files when applicable.  
  
## **previewImages**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Preview image files with  `<img>`.  
  
## **previewAudio**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Preview image files with  `<audio>`.  
  
## **previewVideo**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Preview image files with  `<video>`.  
  
## **imagesExpandable**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Images expand and contract on click.  
  
## **copyable**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Copy button appears in file toolbar to copy file. (Will upload on copy if `uploadOnInput = true`)  
  
## **downloadable**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Download button appears in file toolbar to download file.  
  
## **showFilename**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Show file name in file display.  
  
## **editableFilename**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Edit filename button appears next to file name.  
  
## **removeable**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** If provided, files are removeable.  
  
## **removeIndividually**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** If true, only one remove file request will be made at once. Otherwise, they will be grouped into an   array.
  
## **removeOnClick**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** If true, remove file request will be made when remove button is clicked.  
  
## **maxFiles**  
**Type:** `Number`  
**Default:** `10`  
**Usage:** Maximum number of allowable files to be uploaded.  
  
## **maxFileSize**  
**Type:** `Number`  
**Default:** `10485760` (10MB)  
**Usage:** Maximum file size allowed in bytes  
  
## **displayContainer**  
**Type:** `String | HTMLElement`  
**Default:** `HTMLElement`  
**Usage:** Container element or ID of container that holds file previews.  
  
## **acceptedFileTypes**  
**Type:** `String | String[]`  
**Default:** `null`  
**Usage:** Provide comma-separated string or array of file MIME types to be enforced on the file input. All types   are allowed if *null*.
  
## **acceptedExtensions**  
**Type:** `String | String[]`  
**Default:** `null`  
**Usage:** Provide comma-separated string or array of file extensions to be enforced on the file input. All   extensions are allowed if *null*.
  
## **resize**  
**Type:** `Boolean`  
**Default:** `false`  
**Usage:** Images will be resized within `maxWidth` and `maxHeight`, maintaining aspect ratio.  
  
## **resize**  
**Type:** `Boolean`  
**Default:** `1920`  
**Usage:** Image resize maximum width.  
  
## **maxHeight**  
**Type:** `Number`  
**Default:** `1080`  
**Usage:** Image resize maximum height.  
  
## **dropify**  
**Type:** `Boolean`  
**Default:** `true`  
**Usage:** Use drag-and-drop file input.  
  
## **iconType**  
**Type:** `String('fa' | 'mdi' | 'text')`  
**Default:** `text`  
**Usage:** Use either Font Awesome, Material Icons, or text for icons.  
  
## **uploadUrl**  
**Type:** `String`  
**Default:** `''`  
**Usage:** URL used for `upload` OR `save` request.  
  
## **removeUrl**  
**Type:** `String`  
**Default:** `''`  
**Usage:** URL used for `remove` OR `save` request.  
  
## **saveFilenameCallbackUrl**  
**Type:** `String`  
**Default:** `''`  
**Usage:** URL used for `saveFilename` request.  

# Callbacks  

## **alertCallback**  
**Type:** `function({ message: String, type: String('success' | 'info' | 'warning' | 'error') })`  
**Default:** `window.alert(alert.message)`  
**Usage:** Callback for common events such as *success*ful file upload, *warning* about a maximum file size, an *error* uploading files.

## **loadingCallback**  
**Type:** `function(loading: Boolean)`  
**Default:** `() => {}`  
**Usage:** `Create a loading screen while making requests.  

## **progressCallback**  
**Type:** `function({ runningIndex: Number, finalIndex: Number, runningSize: Number, totalSize: Number })`  
**Default:** `() => {}`  
**Usage:** `Create a progress bar while making multiple requests (*uploadIndividually* and/or *removeIndividually*)  
  
# Methods  

## **upload**  
**Arguments:**  
- `fileIds` - The fileId(s) of files to upload. Null will select all files. 
  - Type: `null | String | String[]`
  - Default: `null`

**Returns:** Nothing   
**Usage:** Make POST request to `uploadUrl` with new and modified files. Also used by **save** if either **uploadIndividually** or **removeIndividually** are true.

## **getUploadPayload**  
**Arguments:**  
- `fileIds` - The fileId(s) of files to upload. Null will select all files. 
  - Type: `null | String | String[]`
  - Default: `null`  
- `forceAll` - If false, files are checked if they are already uploaded and unmodified (in sync with the server). If true, all selected files will be uploaded regardless.
  - Type: `Boolean`
  - Default: `false`

**Returns:** `FormData | Object`  
**Usage:** Get payload for upload of files. 

### **Payload Structure:**  

  **JSON:**  
  **Single:**
  ```  
  {  
      name (String): file name,  
      size (Number): file size in bytes,  
      type (String): file Mime type,  
      dataUrl (String): base-64 encoded file data prefixed with data scheme,  
  }  
  ```  

  Example:
  ```
  {
      "url": "\/examples\/uploads\/index.php",
      "name": "index.php",
      "size": 13376
  }
  ```

  **Multiple**:  
  ```
  [
      {
          fileId (String): file ID to map non-individual response to correct file,
          name (String): file name,
          size (Number): file size in bytes,
          type (String): file Mime type,
          dataUrl  (String): base-64 encoded file data prefixed with data scheme,
      }
  ]
  ```

  Example:
  ```
  [
      {
          "url": "\/examples\/uploads\/index.php",
          "name": "index.php",
          "size": 13376
      }
  ]
  ```

  ### **Form Data:**
  **Single**
  ```
    fileId (String) = file ID to map non-individual response to correct file,
    name (String) = file name,
    size (Number) = file size in bytes,
    type (String) = file Mime type,
    this.id (File) = file (this will be parsed out to $_FILES in php),
  ```

  Example in which an image was cropped:

  ```
  $_FILES = Array
  (
      [ff_files] => Array
          (
              [name] => my_img_2070.jpg
              [type] => image/jpeg
              [tmp_name] => /tmp/phpsgwkRT
              [error] => 0
              [size] => 2849
          )
  )

  $_POST = Array
  (
      [fileId] => 63gc93
      [name] => my_img_2070.jpg
      [size] => 2849
      [type] => image/jpeg
      [existingUrl] => Array
          (
              [url] => /examples/uploads/IMG2070.jpg
              [name] => IMG2070.jpg
              [size] => 3543
          )
      [fileModified] => 1
)
  ```

  **Multiple:**
  
  ```
    <file index>[fileId] (String) = file ID to map non-individual response to correct file,
    <file index>[name] (String) = file name,
    <file index>[size] (Number) = file size in bytes,
    <file index>[type] (String) = file Mime type,
    <this.id>[file index] (File) = file (this will be parsed out to $_FILES in php),
  ```

  Example:

  ```
  $_FILES = Array
  (
      [ff_files] => Array
          (
              [name] => Array
                  (
                      [0] => IMG2360.jpg
                      [1] => IMG2383.jpg
                  )

              [type] => Array
                  (
                      [0] => image/jpeg
                      [1] => image/jpeg
                  )

              [tmp_name] => Array
                  (
                      [0] => /tmp/phpw9f0vV
                      [1] => /tmp/phpMfulHU
                  )

              [error] => Array
                  (
                      [0] => 0
                      [1] => 0
                  )

              [size] => Array
                  (
                      [0] => 1735917
                      [1] => 1761533
                  )
          )
  )

  $_POST = Array
  (
      [0] => Array
          (
              [name] => IMG2360.jpg
              [type] => image/jpeg
              [tmp_name] => /tmp/phpw9f0vV
              [error] => 0
              [size] => 1735917
          )

      [1] => Array
          (
              [name] => IMG2383.jpg
              [type] => image/jpeg
              [tmp_name] => /tmp/phpMfulHU
              [error] => 0
              [size] => 1761533
          )

  )
  ```

## **remove**  
**Arguments:**
- `fileIds` - The fileId(s) of files to remove. Null will select all files. 
  - Type: `null | String | String[]`
  - Default: `null`

**Returns:** Nothing  
**Usage:** Make upload request to `uploadUrl` with new and modified files. Also used by **save** if either **uploadIndividually** or **removeIndividually** are true.
  
## **getRemovePayload**  
**Arguments:**  
- `fileIds` - The fileId(s) of files to upload. Null will select all files. 
  - Type: `null | String | String[]`
  - Default: `null`  
- `forceAll` - If false, files are checked if they are in `this.removedFiles` (added to by `remove`). If true, all selected files will be added.
  - Type: `Boolean`
  - Default: `false`

**Returns:** `Form Data | Object`  
**Usage:** Get payload for removal of files.  

  **Payload Structure**  
  
  **JSON:**  

  **Single:**
  ```  
  {  
      url (String): existing URL,  
      name (String): file name,
      ...rest of `existingUrl` keys  
  }  
  ```  

  Example:
  ```
  {
      "url": "/examples/uploads/IMG2383.jpg",
      "name": "IMG2383.jpg",
      "size": 13376
  }
  ```

  **Multiple**:  
  ```
  [
      {
          url (String): existing URL,  
          name (String): file name,
          ...rest of `existingUrl` keys  
      }
  ]
  ```

  Example:
  ```
  [
      {
          "url": "/examples/uploads/IMG2383.jpg",
          "name": "IMG2383.jpg",
          "size": 13376
      }
  ]
  ```

  **Form Data:**  

  **Single:**
  ```  
  url (Number): file size in bytes,  
  name (String): file name,  
  type (String): file Mime type,   
  ```  

  Example:
  ```
  $_POST: Array
  (
      [url] => /examples/uploads/IMG2383.jpg
      [name] => IMG2383.jpg
      [size] => 17
  )
  ```

  **Multiple**:  
  ```
  <removed index>[url]: /examples/uploads/IMG2383.jpg,
  <removed index>[name]: file name
  ```

  Example:
  ```
  $_POST: Array
  (
      [0] => Array
          (
              [url] => /examples/uploads/.gitignore
              [name] => .gitignore
              [size] => 17
          )
  )
  ```

## **save**  
**Arguments:**
- `fileIds` - The fileId(s) of files to save. Null will select all files. 
  - Type: `null | String | String[]`
  - Default: `null`

**Returns:** Nothing  
**Usage:** Make save request dynamically depending on `removeIndividually` and `uploadIndividually`. If both are false, dualPayload is used to combine both upload and remove payloads.
  
## **getDualPayload**  
**Arguments:**  
- `fileIds` - The fileId(s) of files to upload. Null will select all files. 
  - Type: `null | String | String[]`
  - Default: `null`  
- `forceAll` - If false, files are checked if they need to be uploaded (new or modified) and if they need to be removed (they are in `this.removedFiles` added to by `remove`). If true, all selected files will be added.
  - Type: `Boolean`
  - Default: `false`

**Returns:** `Form Data | Object`  
**Usage:** This method combines upload and remove requests and returns a single payload for save request.

  **Payload Structure**  
  
  **JSON:**  

  ```
  {  
      files: upload payload,
      removedFiles: remove payload  
  }  
  ```

  Example:
  ```
  {
      "files": [
          {
              "fileId": "s2ztsf",
              "name": "recRear.jpg",
              "size": 3337,
              "type": "image/jpeg",
              "dataUrl": "data:image/jpeg;base64, ..."
          }
      ],
      "removedFiles": [
          {
              "url": "/examples/uploads/recFront.jpg",
              "name": "recFront.jpg",
              "size": 3443
          }
      ]
  }
  ```

  **Form Data:**  

  ```
  files<file index>[fileId] (String) = file ID to map non-individual response to correct file,
  files<file index>[name] (String) = file name,
  files<file index>[size] (Number) = file size in bytes,
  files<file index>[type] (String) = file Mime type,
  files<this.id>[file index] (File) = file (this will be parsed out to $_FILES in php),
  removedFiles[<removed index>][url]: existing URL,
  removedFiles[<removed index>][name]: file name
  ```

  Example:
  ```
  $_POST = Array
  (
      [files] => Array
          (
              [0] => Array
                  (
                      [fileId] => 14gvsg
                      [name] => recRear.jpg
                      [size] => 3337
                      [type] => image/jpeg
                  )
          )
      [removedFiles] => Array
          (
              [0] => Array
                  (
                      [url] => /examples/uploads/recFront.jpg
                      [name] => recFront.jpg
                      [size] => 3443
                  )
          )
  )

  $_FILES = Array
  (
      [ff_files] => Array
          (
              [name] => Array
                  (
                      [0] => recRear.jpg
                  )

              [type] => Array
                  (
                      [0] => image/jpeg
                  )

              [tmp_name] => Array
                  (
                      [0] => /tmp/php6DXW3T
                  )

              [error] => Array
                  (
                      [0] => 0
                  )

              [size] => Array
                  (
                      [0] => 3337
                  )
          )
  )
  ```


# Plugins & Extensions
## Paging
- Adds simple pagination feature.
- Parameters:
  - **perPage:** Maximum files per page
    - Type: `Number`
    - Default: `10`
  - **hidePagingWhenSinglePage:** If `perPage` files or less exist, the pagination widget will be hidden.
    - Type: `Boolean`
    - Default: `false`
  - **pagingContainer:** Provide an HTML Element of the ID of one, otherwise, one will be created.
    - Type: `String | HTMLElement | null`
    - Default: `HTMLDivElement`
  - **showPageInput:** If true, the part of the widget showing the current page will be an input element that navigates to the page on focusout or enter.
    - Type: `
## Directories
## Debug
- Provides tools for viewing and modifying configuration options, request payloads, and other attributes on the instance and its files.
- Useful for development and building a backend while being able to easily view payload structure on different events.
## Cropper.js
- Requires [Cropper.js](https://github.com/fengyuanchen/cropperjs)

# Examples:

## PHP:
- Start server from root of repository: `php -S localhost:5000`
- Go to [localhost:5000/examples/php/index.php](localhost:5000/examples/php/index.php)

# Notes

- Remove requests will be made before upload requests on save if possible. If `uploadIndividually` and `removeIndividually` are both false, a dual payload will be used. In this case, if you are modifying existing files, it is important to always handle file removals before uploads.

- File uploads may fail due to configurations in your `php.ini` file:
  - Check `phpinfo()` for the path to your `php.ini` file: `Loaded Configuration File`.
  - `upload_max_filesize` is the maximum size of any single file.
  - `max_file_uploads` is the maximum number of files that can be uploaded.
  - `post_max_size` is the maximum size of the entire request, including files.
  ```
    sed -i 's/upload_max_filesize = .*/upload_max_filesize = '<NEW MAX FILE SIZE>'/' /etc/php/7.4/cli/php.ini
  ```